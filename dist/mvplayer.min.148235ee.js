var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.Strip=function(){function a(a,b,c){this.width=a,this.height=b,this.image_url=c.dataset.url,this.frame_count=parseInt(c.dataset.framesCount,10),this.element=c,this._initStyles(),this._initFrames(),this._initStripImages()}return a.prototype._initStyles=function(){this.element.style.position="absolute"},a.prototype._initFrames=function(){this.frames=[];for(var a=0;a<this.frame_count;a++){var b={top:this.height*a};this.frames.push(b)}this.frame_index=0},a.prototype._initStripImages=function(){this.imageElement=this.element.getElementsByTagName("img")[0],this.imageElement.style.width=this.width+"px",this.imageElement.style.height=this.height*this.frame_count+"px"},a.prototype.activate=function(){this.element.style.display=""},a.prototype.deactivate=function(){this.element.style.display="none",this.reset()},a.prototype.isFinished=function(){return this.frame_index===this.frame_count-1},a.prototype.load=function(a){this.imageElement.addEventListener("load",a,!1),this.imageElement.src=this.image_url},a.prototype.move=function(){this.frame_index++},a.prototype.show=function(){var a=this.frames[this.frame_index];this.element.style.top=-1*a.top+"px"},a.prototype.reset=function(){return this.frame_index=0,this.show()},a}();var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.MultiStrip=function(){function a(a,b,c){this.strips=[];for(var d=0;d<c.length;d++){var e=new MVPlayer.Strip(a,b,c[d]);this.strips.push(e)}this.strip_index=0,this.strip_loaded_count=0,this.strip_already_loading=!1}return a.prototype.getCurrentFrameIndex=function(){for(var a=0,b=0;b<this.strips.length&&!(this.strip_index<b);b++){var c=this.strips[b];a+=this.strip_index===b?c.frame_index+1:c.frame_count}return a},a.prototype.getTotalFrameCount=function(){for(var a=0,b=0;b<this.strips.length;b++)a+=this.strips[b].frame_count;return a},a.prototype.isInit=function(){return 1===this.getCurrentFrameIndex()},a.prototype.isFinished=function(){return this.getCurrentFrameIndex()===this.getTotalFrameCount()},a.prototype.load=function(a){if(this.strip_loaded_count===this.strips.length)return void a(null);if(this.strip_already_loading)return void a("already");this.strip_already_loading=!0;for(var b=this,c=function(){b.strip_loaded_count++,b.strip_loaded_count===b.strips.length&&a(null)},d=0;d<this.strips.length;d++)this.strips[d].load(c)},a.prototype.move=function(){var a=this.strips[this.strip_index];if(a.isFinished()){if(a.deactivate(),this.strip_index===this.strips.length-1)return;a=this.strips[++this.strip_index],a.activate()}a.move()},a.prototype.show=function(){var a=this.strips[this.strip_index];a.show()},a.prototype.reset=function(){var a=this.strips[this.strip_index];a.deactivate(),this.strip_index=0;var b=this.strips[this.strip_index];b.activate()},a}();var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.Player=function(){function a(a){var b=a.dataset,c=parseInt(b.frameWidth,10),d=parseInt(b.frameHeight,10);this.movie=new MVPlayer.MultiStrip(c,d,a.getElementsByClassName("strip")),this.dispatcher=new MVPlayer.PlayerEventDispatcher,this.fps=parseInt(b.fps,10),this.element=a,this.element.style.width=c+"px",this.element.style.height=d+"px",this.element.style.position="relative",this.element.style.overflow="hidden"}return a.prototype.load=function(a){this.movie.load(function(b){a(b)})},a.prototype.play=function(){this.timerId||(this.movie.isInit()?this.dispatcher.didStart():this.dispatcher.didResume(),this.timerId=setInterval(function(a){return function(){if(a.movie.isFinished())a.pause(),a.movie.reset(),a.dispatcher.didFinish();else{a.movie.show(),a.movie.move();var b=a.movie.getCurrentFrameIndex(),c=a.movie.getTotalFrameCount();b===Math.floor(c/4)&&a.dispatcher.firstQuartile(),b===Math.floor(c/2)&&a.dispatcher.half(),b===Math.floor(c/4*3)&&a.dispatcher.thirdQuartile()}}}(this),1e3/this.fps))},a.prototype.pause=function(){this.timerId&&(this.movie.isFinished()||this.dispatcher.didPause(),clearInterval(this.timerId),this.timerId=void 0)},a}();var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.AppearanceDetector=function(){function a(a,b,c,d,e){this.element=a,this.top_margin=b,this.bottom_margin=c,this.didAppear=d,this.didDisappear=e,this.wasVisible=!1,this.detect()}return a.prototype._topVisible=function(){var a=this.element.getBoundingClientRect().top;return a+this.top_margin>0},a.prototype._bottomVisible=function(){var a=this.element.getBoundingClientRect().bottom,b=window.innerHeight;return a-this.bottom_margin<b},a.prototype._isVisible=function(){return this._topVisible()&&this._bottomVisible()},a.prototype.detect=function(){var a=this._isVisible();a!==this.wasVisible&&(a&&!this.wasVisible?this.didAppear():this.didDisappear(),this.wasVisible=a)},a}();var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.PlayerEventDispatcher=function(){function a(){}return a.prototype.didStart=function(){console.log("didStart")},a.prototype.didResume=function(){console.log("didResume")},a.prototype.didFinish=function(){console.log("didFinish")},a.prototype.firstQuartile=function(){console.log("firstQuartile")},a.prototype.half=function(){console.log("half")},a.prototype.thirdQuartile=function(){console.log("thirdQuartile")},a.prototype.didPause=function(){console.log("didPause")},a}();var MVPlayer=window.MVPlayer=window.MVPlayer||{};MVPlayer.Controller=function(){function a(a,b){e=!0,a.load(function(c){e&&!c&&(b&&(b.style.display="none"),a.element.style.display="",a.play())})}function b(a){e=!1,a.pause()}function c(c,d,e,f){!function(a){c.dispatcher.didFinish=function(){return a.call(c.dispatcher),e||f?(c.element.style.display="none",e&&(e.style.display=""),void(f&&(f.style.display=""))):void c.play()}}(c.dispatcher.didFinish),e&&e.addEventListener("click",function(){c.element.style.display="",e&&(e.style.display="none"),f&&(f.style.display="none"),c.play()},!1);var g=new MVPlayer.AppearanceDetector(c.element,90,90,function(){a(c,d)},function(){b(c)});document.addEventListener("scroll",function(){g.detect()})}var d={},e=!1;return d.run=function(a){var b=a.getElementsByClassName("play-scene")[0];if(b){var d=new MVPlayer.Player(b),e=a.getElementsByClassName("load-scene")[0],f=a.getElementsByClassName("replay-scene")[0],g=a.getElementsByClassName("done-scene")[0];c(d,e,f,g)}},d}();